DROP TABLE ALUMNO;

CREATE TABLE ALUMNO(
   num_mat NUMBER(5),
   nombre VARCHAR2(20),
   apellido VARCHAR2(40),
   direccion VARCHAR2(50),
   fecha_nac DATE,
   CONSTRAINT PK_ALUMNO PRIMARY KEY (num_mat),
   CONSTRAINT NN_ALUMNO_NOMBRE CHECK (nombre IS NOT NULL),
   CONSTRAINT CK_ALUMNO_NUM_MAT CHECK (num_mat > 0)
);

INSERT INTO ALUMNO VALUES(27112, 'LALO', 'LALEZ', 'C/ DEL LALO', '1/1/2008');
INSERT INTO ALUMNO VALUES(27092, 'LOLO', 'LOLEZ', 'C/ DEL LOLO', '12/10/2008');
INSERT INTO ALUMNO VALUES(27093, 'LELO', 'LOLEZ', 'C/ DEL LOLO', '12/10/2008');

DROP TABLE ASIGNATURA;

CREATE TABLE ASIGNATURA(
   num_asig NUMBER(5),
   nombre VARCHAR2(30),
   horas NUMBER(2),
   aula VARCHAR2(5),
   CONSTRAINT PK_ASIGNATURA PRIMARY KEY (num_asig),
   CONSTRAINT NN_ASIGNATURA_NOMBRE CHECK (nombre IS NOT NULL),
   CONSTRAINT NN_ASIGNATURA_HORAS CHECK (horas IS NOT NULL),
   CONSTRAINT CK_ASIGNATURA_HORAS CHECK (horas > 0)
);

INSERT INTO ASIGNATURA VALUES (1, 'BASES DE DATOS', 6, 'S2');
INSERT INTO ASIGNATURA VALUES (2, 'ENTORNOS DE DESARROLLO', 3, 'S2');
INSERT INTO ASIGNATURA VALUES (3, 'PROGRAMACION DE SERVICIOS', 3, 'S1');
INSERT INTO ASIGNATURA VALUES (4, 'MATES', 3, NULL);
INSERT INTO ASIGNATURA VALUES (5, 'HISTORIA', 4, 'H1');

COMMIT;

DROP TABLE ALUMNO_ASIG;

CREATE TABLE ALUMNO_ASIG(
   Num_alumno NUMBER(5),
   Num_asignatura NUMBER(5),
   CONSTRAINT PK_ALUMNO_ASIG PRIMARY KEY (Num_alumno, Num_asignatura),
   CONSTRAINT FK_ALUMNO_ASIG_Num_alumno FOREIGN KEY (Num_alumno) REFERENCES ALUMNO,
   CONSTRAINT FK_ALUMNO_ASIG_Num_asignatura FOREIGN KEY (Num_asignatura) REFERENCES ASIGNATURA
);

// EN ESTA TABLA INTERMEDIA ME INTERESA MUCHISIMO !!! TENER ESA PK COMBINADA
// PORQUE DE ESTE MODO EVITO EL EFECTO "NIÑO COÑÓN" DE MODO QUE NADIE ME VA A 
// PODER REPETIR INSISTENTEMENTE QUE UN ALUMNO ESTÁ MATRICULADO EN UNA ASIGNATURA
// CONCRETA, PORQUE SINO PODRÍA TENER VARIOS REGISTROS "1,1" SIENDO 1 (EL DE LA IZDA)
// EL ALUMNO Y EL OTRO "1" LA ASIGNATURA . . . ESTE PROBLEMA SI LUEGO REALIZO UN 
// CONTEO DE ASIGNATURAS QUE ESTÁ CURSANDO EL ALUMNO ME PODRÍA DEVOLVER DATOS FALSOS.
// POR OTRO LADO ES INTERESANTE QUE ESTOS DOS CAMPOS AL SER PK NO PODRÁN SER NULL Y 
// TENDRÁN UN INDICE ASOCIADO QUE ACELERARÁ LAS BÚSQUEDAS . . . 

INSERT INTO ALUMNO_ASIG VALUES (27112, 1);
INSERT INTO ALUMNO_ASIG VALUES (27112, 2);
INSERT INTO ALUMNO_ASIG VALUES (27093, 1);
//INTENTO METER UN ALUMNO SIN ASIGNATURA
INSERT INTO ALUMNO_ASIG VALUES (27112, NULL); 
// INTENTO METER UN ALUMNO INEXISTENTE
INSERT INTO ALUMNO_ASIG VALUES (6969, 1); 
// INTENTO METER UNAS ASIGNATURA INEXISTENTE
INSERT INTO ALUMNO_ASIG VALUES (27112, 112); 
// INTENTO METER UN DUPLICADO
INSERT INTO ALUMNO_ASIG VALUES (27112, 1); 